<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Place New Order | Galit Digital Printing</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="../assets/css/style.css" rel="stylesheet">
</head>
<body class="bg-light">
    <!-- Customer Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-info">
        <div class="container">
            <a class="navbar-brand" href="../index.html">Galit Digital Printing</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">
                            <i class="bi bi-house-door me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="place_order.html">
                            <i class="bi bi-plus-circle me-1"></i>New Order
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="track_order.html">
                            <i class="bi bi-truck me-1"></i>Track Order
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle me-1"></i>My Account
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#">Profile</a></li>
                            <li><a class="dropdown-item" href="#">Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="../index.html">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-4">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card dashboard-card">
                    <div class="card-body">
                        <h2 class="card-title mb-4">
                            <i class="bi bi-plus-circle me-2"></i>Place New Order
                        </h2>
                        <form id="orderForm">
                            <!-- Service Category Selection -->
                            <div class="mb-4">
                                <h5 class="mb-3">
                                    <i class="bi bi-list-ul me-2"></i>Select Service Category
                                </h5>
                                <div class="row g-3">
                                    <div class="col-md-6 col-lg-4">
                                        <div class="card service-card" onclick="selectService('shirts')" id="shirts-card">
                                            <div class="card-body text-center">
                                                <i class="bi bi-person-workspace fs-1 text-primary mb-2"></i>
                                                <h6 class="card-title">Shirts</h6>
                                                <small class="text-muted">Custom apparel printing</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="card service-card" onclick="selectService('tarpaulin')" id="tarpaulin-card">
                                            <div class="card-body text-center">
                                                <i class="bi bi-file-earmark-text fs-1 text-success mb-2"></i>
                                                <h6 class="card-title">Tarpaulin</h6>
                                                <small class="text-muted">Large format printing</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="card service-card" onclick="selectService('print-xerox')" id="print-xerox-card">
                                            <div class="card-body text-center">
                                                <i class="bi bi-printer fs-1 text-warning mb-2"></i>
                                                <h6 class="card-title">Print & Xerox</h6>
                                                <small class="text-muted">Document printing</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="card service-card" onclick="selectService('stickers')" id="stickers-card">
                                            <div class="card-body text-center">
                                                <i class="bi bi-tag fs-1 text-info mb-2"></i>
                                                <h6 class="card-title">Stickers</h6>
                                                <small class="text-muted">Vinyl and adhesive</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="card service-card" onclick="selectService('others')" id="others-card">
                                            <div class="card-body text-center">
                                                <i class="bi bi-three-dots fs-1 text-secondary mb-2"></i>
                                                <h6 class="card-title">Others</h6>
                                                <small class="text-muted">Additional services</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="selectedService" name="serviceCategory" required>
                            </div>

                            <!-- Tarpaulin Size Input (Hidden by default) -->
                            <div class="mb-4" id="tarpaulinSizeSection" style="display: none;">
                                <h5 class="mb-3">
                                    <i class="bi bi-rulers me-2"></i>Tarpaulin Size Specification
                                </h5>
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle me-2"></i>
                                    Please specify the exact size for your tarpaulin order.
                                </div>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Width</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="tarpaulinWidth" placeholder="0" step="0.1" min="0">
                                            <span class="input-group-text">ft</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Height</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="tarpaulinHeight" placeholder="0" step="0.1" min="0">
                                            <span class="input-group-text">ft</span>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label">Size Description</label>
                                        <input type="text" class="form-control" id="tarpaulinSizeDescription" placeholder="e.g., 3ft x 6ft banner" readonly>
                                    </div>
                                </div>
                            </div>

                            <!-- Others Services Selection (Hidden by default) -->
                            <div class="mb-4" id="othersServicesSection" style="display: none;">
                                <h5 class="mb-3">
                                    <i class="bi bi-list-check me-2"></i>Select Specific Service
                                </h5>
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle me-2"></i>
                                    Choose the specific service you need from the list below.
                                </div>
                                <div class="row g-3">
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="reflectiveSignage" value="Reflective Signage">
                                            <label class="form-check-label" for="reflectiveSignage">Reflective Signage</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="panaflexSignage" value="Panaflex Signage">
                                            <label class="form-check-label" for="panaflexSignage">Panaflex Signage</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="vehicleDecals" value="Vehicle Decals">
                                            <label class="form-check-label" for="vehicleDecals">Vehicle Decals</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="acrylicPlates" value="Acrylic Plates">
                                            <label class="form-check-label" for="acrylicPlates">Acrylic Plates</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="plaque" value="Plaque">
                                            <label class="form-check-label" for="plaque">Plaque</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="personalizeMugs" value="Personalize Mugs">
                                            <label class="form-check-label" for="personalizeMugs">Personalize Mugs</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="printerRepair" value="Printer Repair">
                                            <label class="form-check-label" for="printerRepair">Printer Repair</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="pvcId" value="PVC ID">
                                            <label class="form-check-label" for="pvcId">PVC ID</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="eventSash" value="Event Sash">
                                            <label class="form-check-label" for="eventSash">Event Sash</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="sintraFrames" value="Sintra Frames">
                                            <label class="form-check-label" for="sintraFrames">Sintra Frames</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="standees" value="Standees">
                                            <label class="form-check-label" for="standees">Standees</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="subliUniforms" value="SubliUniforms">
                                            <label class="form-check-label" for="subliUniforms">SubliUniforms</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="fridgeMagnets" value="Fridge Magnets">
                                            <label class="form-check-label" for="fridgeMagnets">Fridge Magnets</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="sintraboardStandee" value="Sintraboard Standee">
                                            <label class="form-check-label" for="sintraboardStandee">Sintraboard Standee</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="idLace" value="ID Lace">
                                            <label class="form-check-label" for="idLace">ID Lace</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="steelPlateSignage" value="Steel Plate Signage">
                                            <label class="form-check-label" for="steelPlateSignage">Steel Plate Signage</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="acrylicMedal" value="Acrylic Medal">
                                            <label class="form-check-label" for="acrylicMedal">Acrylic Medal</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="acrylicSignage" value="Acrylic Signage">
                                            <label class="form-check-label" for="acrylicSignage">Acrylic Signage</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="sintraboardDoorLabels" value="Sintraboard Door Labels">
                                            <label class="form-check-label" for="sintraboardDoorLabels">Sintraboard Door Labels</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="callingCard" value="Calling Card">
                                            <label class="form-check-label" for="callingCard">Calling Card</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="acrylicTableNames" value="Acrylic Table Names">
                                            <label class="form-check-label" for="acrylicTableNames">Acrylic Table Names</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="photoFrames" value="Photo Frames">
                                            <label class="form-check-label" for="photoFrames">Photo Frames</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="woodEngraving" value="Wood Engraving">
                                            <label class="form-check-label" for="woodEngraving">Wood Engraving</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="giveaways" value="Giveaways">
                                            <label class="form-check-label" for="giveaways">Giveaways</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="blackout" value="Blackout">
                                            <label class="form-check-label" for="blackout">Blackout</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="neonLed" value="Neon LED">
                                            <label class="form-check-label" for="neonLed">Neon LED</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="dtf" value="DTF">
                                            <label class="form-check-label" for="dtf">DTF</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="othersService" id="decals" value="Decals">
                                            <label class="form-check-label" for="decals">Decals</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Order Details -->
                            <div class="mb-4">
                                <h5 class="mb-3">
                                    <i class="bi bi-clipboard-data me-2"></i>Order Details
                                </h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Quantity</label>
                                        <input type="number" class="form-control" id="quantity" name="quantity" required min="1">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Preferred Due Date</label>
                                        <input type="date" class="form-control" id="dueDate" name="dueDate" required>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label">Special Instructions</label>
                                        <textarea class="form-control" id="instructions" name="instructions" rows="3" placeholder="Any specific requirements or notes..."></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- File Upload -->
                            <div class="mb-4">
                                <h5 class="mb-3">
                                    <i class="bi bi-cloud-upload me-2"></i>Design Files
                                </h5>
                                <div class="upload-zone p-4 border border-dashed rounded" onclick="document.getElementById('fileUpload').click()">
                                    <i class="bi bi-cloud-upload fs-1 text-muted mb-2"></i>
                                    <p class="mb-1">Drag and drop your files here or click to browse</p>
                                    <small class="text-muted">Accepted formats: PDF, JPG, PNG, AI (max 20MB)</small>
                                    <input type="file" class="d-none" id="fileUpload" multiple accept=".pdf,.jpg,.jpeg,.png,.ai">
                                </div>
                                <div id="fileList" class="mt-2"></div>
                            </div>

                            <!-- Delivery Options -->
                            <div class="mb-4">
                                <h5 class="mb-3">
                                    <i class="bi bi-truck me-2"></i>Delivery Preference
                                </h5>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="delivery" id="pickup" value="pickup" checked>
                                    <label class="form-check-label" for="pickup">
                                        <i class="bi bi-shop me-2"></i>Store Pickup (Free)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="delivery" id="delivery" value="delivery">
                                    <label class="form-check-label" for="delivery">
                                        <i class="bi bi-truck me-2"></i>Delivery (Additional fee applies)
                                    </label>
                                </div>
                            </div>

                            <!-- Order Information -->
                            <div class="card bg-light mb-4">
                                <div class="card-body">
                                    <h5 class="mb-3">
                                        <i class="bi bi-info-circle me-2"></i>Order Information
                                    </h5>
                                    <div class="alert alert-info mb-3">
                                        <i class="bi bi-clock me-2"></i>
                                        <strong>Order Review Process:</strong> Your order will be reviewed by our staff who will contact you with pricing and confirmation details.
                                    </div>
                                    <div class="row">
                                        <div class="col-8">Estimated Processing Time:</div>
                                        <div class="col-4 text-end">1-2 business days</div>
                                        <div class="col-8">Order Status:</div>
                                        <div class="col-4 text-end text-warning">Pending Review</div>
                                        <div class="col-8">Next Step:</div>
                                        <div class="col-4 text-end">Staff will contact you</div>
                                    </div>
                                </div>
                            </div>

                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="bi bi-check-circle me-2"></i>Submit Order
                                </button>
                                <button type="button" class="btn btn-outline-secondary" onclick="saveAsDraft()">
                                    <i class="bi bi-save me-2"></i>Save as Draft
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/js/sales-data.js"></script>
    <script>
        // Fallback sales data manager if file not found
        if (typeof window.salesDataManager === 'undefined') {
            console.log('Sales data manager not found, creating fallback...');
            window.salesDataManager = {
                addSale: function(saleData) {
                    try {
                        let sales = JSON.parse(localStorage.getItem('galitDigitalSalesData')) || [];
                        saleData.id = Date.now();
                        saleData.timestamp = new Date().toISOString();
                        saleData.date = new Date().toDateString();
                        sales.push(saleData);
                        localStorage.setItem('galitDigitalSalesData', JSON.stringify(sales));
                        console.log('Sale saved to localStorage:', saleData);
                    } catch (error) {
                        console.error('Error saving sale:', error);
                    }
                },
                getAllSales: function() {
                    try {
                        return JSON.parse(localStorage.getItem('galitDigitalSalesData')) || [];
                    } catch (error) {
                        console.error('Error getting sales:', error);
                        return [];
                    }
                }
            };
        }
    </script>
    <script>
        let selectedService = null;
        let uploadedFiles = [];

        // Service selection functionality
        function selectService(service) {
            // Remove active class from all cards
            document.querySelectorAll('.service-card').forEach(card => {
                card.classList.remove('border-primary', 'bg-primary', 'text-white');
                card.classList.add('border-light');
            });

            // Add active class to selected card
            const selectedCard = document.getElementById(service + '-card');
            selectedCard.classList.add('border-primary', 'bg-primary', 'text-white');
            selectedCard.classList.remove('border-light');

            // Set hidden input value
            document.getElementById('selectedService').value = service;
            selectedService = service;

            // Hide all conditional sections
            document.getElementById('tarpaulinSizeSection').style.display = 'none';
            document.getElementById('othersServicesSection').style.display = 'none';

            // Show relevant sections based on selection
            if (service === 'tarpaulin') {
                document.getElementById('tarpaulinSizeSection').style.display = 'block';
            } else if (service === 'others') {
                document.getElementById('othersServicesSection').style.display = 'block';
            }

            // Update price estimate
            updatePriceEstimate();
        }

        // Tarpaulin size calculation
        function updateTarpaulinSize() {
            const width = document.getElementById('tarpaulinWidth').value;
            const height = document.getElementById('tarpaulinHeight').value;
            
            if (width && height) {
                const sizeDescription = `${width}ft x ${height}ft banner`;
                document.getElementById('tarpaulinSizeDescription').value = sizeDescription;
            } else {
                document.getElementById('tarpaulinSizeDescription').value = '';
            }
            
            updatePriceEstimate();
        }

        // Add event listeners for tarpaulin size inputs
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('tarpaulinWidth').addEventListener('input', updateTarpaulinSize);
            document.getElementById('tarpaulinHeight').addEventListener('input', updateTarpaulinSize);
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dueDate').min = today;
        });

        // Price estimation
        function updatePriceEstimate() {
            let basePrice = 0;
            let additionalCharges = 0;

            if (selectedService) {
                // Base pricing based on service type
                const pricing = {
                    'shirts': 500,
                    'tarpaulin': 800,
                    'print-xerox': 50,
                    'stickers': 200,
                    'others': 300
                };

                basePrice = pricing[selectedService] || 0;

                // Additional charges for tarpaulin based on size
                if (selectedService === 'tarpaulin') {
                    const width = parseFloat(document.getElementById('tarpaulinWidth').value) || 0;
                    const height = parseFloat(document.getElementById('tarpaulinHeight').value) || 0;
                    if (width > 0 && height > 0) {
                        const area = width * height;
                        additionalCharges = Math.round(area * 50); // ₱50 per sq ft
                    }
                }

                // Additional charges for delivery
                const deliveryOption = document.querySelector('input[name="delivery"]:checked');
                if (deliveryOption && deliveryOption.value === 'delivery') {
                    additionalCharges += 200; // ₱200 delivery fee
                }
            }

            const total = basePrice + additionalCharges;

            document.getElementById('basePrice').textContent = `₱${basePrice.toLocaleString()}`;
            document.getElementById('additionalCharges').textContent = `₱${additionalCharges.toLocaleString()}`;
            document.getElementById('totalPrice').textContent = `₱${total.toLocaleString()}`;
        }

        // File upload handling
        document.getElementById('fileUpload').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            uploadedFiles = files;
            displayFileList();
        });

        function displayFileList() {
            const fileList = document.getElementById('fileList');
            if (uploadedFiles.length === 0) {
                fileList.innerHTML = '';
                return;
            }

            let html = '<div class="list-group">';
            uploadedFiles.forEach((file, index) => {
                html += `
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-file-earmark me-2"></i>
                            <span>${file.name}</span>
                            <small class="text-muted ms-2">(${(file.size / 1024 / 1024).toFixed(2)} MB)</small>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeFile(${index})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                `;
            });
            html += '</div>';
            fileList.innerHTML = html;
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            displayFileList();
        }

        // Form submission
        document.getElementById('orderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!selectedService) {
                alert('Please select a service category.');
                return;
            }

            if (selectedService === 'tarpaulin') {
                const width = document.getElementById('tarpaulinWidth').value;
                const height = document.getElementById('tarpaulinHeight').value;
                if (!width || !height || width <= 0 || height <= 0) {
                    alert('Please enter valid tarpaulin dimensions.');
                    return;
                }
            }

            if (selectedService === 'others') {
                const othersService = document.querySelector('input[name="othersService"]:checked');
                if (!othersService) {
                    alert('Please select a specific service from the Others category.');
                    return;
                }
            }

            // Collect form data for database submission
            const formData = {
                customer_name: 'Customer', // In real app, this would come from user login
                customer_email: 'customer@example.com', // In real app, this would come from user profile
                customer_phone: '+63 912 345 6789', // In real app, this would come from user profile
                service_category: selectedService === 'print-xerox' ? 'Print & Xerox' : 
                                 selectedService === 'tarpaulin' ? 'Tarpaulin' :
                                 selectedService === 'stickers' ? 'Stickers' :
                                 selectedService === 'shirts' ? 'Shirts' : 'Others',
                quantity: parseInt(document.getElementById('quantity').value),
                due_date: document.getElementById('dueDate').value,
                instructions: document.getElementById('instructions').value,
                delivery_preference: document.querySelector('input[name="delivery"]:checked').value,
                files_count: uploadedFiles.length
            };

            // Add service-specific data
            if (selectedService === 'tarpaulin') {
                formData.size = document.getElementById('tarpaulinSizeDescription').value;
                formData.service_name = 'Tarpaulin';
            } else if (selectedService === 'others') {
                formData.service_name = document.querySelector('input[name="othersService"]:checked').value;
            } else {
                formData.service_name = formData.service_category;
            }

            // Show loading state
            const submitBtn = document.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Submitting...';
            submitBtn.disabled = true;

            // Generate order ID
            const orderId = 'ORD-' + new Date().getFullYear() + '-' + String(Date.now()).slice(-6);
            
            // Create order data (without pricing)
            const orderData = {
                ...formData,
                order_id: orderId,
                timestamp: new Date().toISOString(),
                status: 'pending_review',
                pricing: null, // No pricing until clerk approval
                clerk_approved: false,
                clerk_price: null,
                clerk_notes: null
            };

            // Save to pending orders (separate from sales)
            const pendingOrder = {
                id: Date.now(),
                order_id: orderId,
                customer_name: formData.customer_name,
                customer_email: formData.customer_email,
                customer_phone: formData.customer_phone,
                service_category: formData.service_category,
                service_name: formData.service_name,
                size: formData.size || null,
                quantity: formData.quantity,
                due_date: formData.due_date,
                instructions: formData.instructions,
                delivery_preference: formData.delivery_preference,
                files_count: formData.files_count,
                timestamp: new Date().toISOString(),
                status: 'pending_review',
                pricing: null,
                clerk_approved: false,
                clerk_price: null,
                clerk_notes: null
            };

            // Save to pending orders storage
            if (window.salesDataManager) {
                window.salesDataManager.addPendingOrder(pendingOrder);
            }

            // Try to submit to PHP backend (optional)
            submitToBackend(formData, orderId, null)
                .then(data => {
                    if (data && data.success) {
                        console.log('Order also saved to database:', data.order_id);
                    }
                })
                .catch(error => {
                    console.log('Database submission failed, but order saved locally:', error);
                })
                .finally(() => {
                    // Show success message
                    alert(`Order submitted successfully!\nOrder ID: ${orderId}\n\nOur staff will review your order and contact you with pricing details within 1-2 business days.\n\nThank you for choosing Galit Digital Printing!`);
                    
                    // Reset form
                    resetForm();
                    
                    // Restore button state
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                });
        });

        function saveAsDraft() {
            alert('Draft saved successfully! You can continue editing later.');
        }

        // Order validation (no pricing calculation needed)
        function validateOrderData(formData) {
            // Basic validation without pricing
            if (!formData.service_category) {
                return 'Please select a service category.';
            }
            
            if (formData.service_category === 'Tarpaulin' && !formData.size) {
                return 'Please enter tarpaulin size.';
            }
            
            if (formData.service_category === 'Others' && !formData.service_name) {
                return 'Please select a specific service from Others category.';
            }
            
            if (!formData.quantity || formData.quantity < 1) {
                return 'Please enter a valid quantity.';
            }
            
            if (!formData.due_date) {
                return 'Please select a due date.';
            }
            
            return null; // No errors
        }

        // Submit to backend (optional)
        async function submitToBackend(formData, orderId, pricing) {
            try {
                const response = await fetch('../api/submit_order.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ...formData,
                        order_id: orderId,
                        amount: pricing.total,
                        base_price: pricing.base_price,
                        additional_charges: pricing.additional_charges
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return data;
            } catch (error) {
                console.log('Backend submission failed:', error);
                throw error;
            }
        }

        function resetForm() {
            document.getElementById('orderForm').reset();
            selectedService = null;
            uploadedFiles = [];
            
            // Reset service cards
            document.querySelectorAll('.service-card').forEach(card => {
                card.classList.remove('border-primary', 'bg-primary', 'text-white');
                card.classList.add('border-light');
            });

            // Hide conditional sections
            document.getElementById('tarpaulinSizeSection').style.display = 'none';
            document.getElementById('othersServicesSection').style.display = 'none';

            // Reset file list
            document.getElementById('fileList').innerHTML = '';

            // Reset price estimate
            updatePriceEstimate();
        }

        // Add event listeners for delivery options
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('input[name="delivery"]').forEach(radio => {
                radio.addEventListener('change', updatePriceEstimate);
            });
        });
    </script>

    <style>
        .service-card {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #e9ecef;
        }

        .service-card:hover {
            border-color: #0d6efd;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .service-card.border-primary {
            border-color: #0d6efd !important;
        }

        .upload-zone {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-zone:hover {
            background-color: #f8f9fa;
            border-color: #0d6efd !important;
        }

        .dashboard-card {
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</body>
</html>
